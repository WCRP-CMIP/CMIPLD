#!/usr/bin/env python3
"""
Simplified src-data processor for debugging
"""

import os
import sys
from pathlib import Path
import mkdocs_gen_files

print("=" * 60, file=sys.stderr)
print("🚀 SRC-DATA PROCESSOR STARTING", file=sys.stderr)
print(f"   Working directory: {os.getcwd()}", file=sys.stderr)
print("=" * 60, file=sys.stderr)

# Check various possible locations for src-data
possible_paths = [
    Path("src-data"),
    Path("../src-data"),
    Path("../../src-data"),
    Path.cwd() / "src-data"
]

src_data_path = None
for path in possible_paths:
    print(f"   Checking: {path.absolute()} ... ", end="", file=sys.stderr)
    if path.exists() and path.is_dir():
        print("FOUND!", file=sys.stderr)
        src_data_path = path
        break
    else:
        print("not found", file=sys.stderr)

if not src_data_path:
    print("❌ No src-data directory found in any location!", file=sys.stderr)
    print("=" * 60, file=sys.stderr)
    # Create a dummy file to show gen-files is working
    with mkdocs_gen_files.open("src-data-docs/not-found.md", "w") as f:
        f.write("# Src-Data Not Found\n\nNo src-data directory was found.")
    sys.exit(0)

print(f"\n✅ Found src-data at: {src_data_path.absolute()}", file=sys.stderr)

# List subdirectories
subdirs = [d for d in src_data_path.iterdir() if d.is_dir() and not d.name.startswith('.')]
print(f"📁 Found {len(subdirs)} subdirectories:", file=sys.stderr)
for d in subdirs:
    print(f"   - {d.name}", file=sys.stderr)

# Create index
print("\n📝 Creating src-data-docs/index.md...", file=sys.stderr)
try:
    with mkdocs_gen_files.open("src-data-docs/index.md", "w") as f:
        f.write("# Source Data Documentation\n\n")
        f.write(f"Found {len(subdirs)} sections:\n\n")
        for d in subdirs:
            f.write(f"- {d.name}\n")
    print("   ✅ Created index.md", file=sys.stderr)
except Exception as e:
    print(f"   ❌ Failed to create index.md: {e}", file=sys.stderr)

# Process each subdirectory
for subdir in subdirs:
    print(f"\n📂 Processing {subdir.name}...", file=sys.stderr)
    
    # Create main page
    try:
        with mkdocs_gen_files.open(f"src-data-docs/{subdir.name}.md", "w") as f:
            f.write(f"# {subdir.name}\n\n")
            f.write(f"Documentation for {subdir.name}\n")
        print(f"   ✅ Created {subdir.name}.md", file=sys.stderr)
    except Exception as e:
        print(f"   ❌ Failed: {e}", file=sys.stderr)
    
    # Create contents page
    try:
        with mkdocs_gen_files.open(f"src-data-docs/{subdir.name}_contents.md", "w") as f:
            f.write(f"# {subdir.name} - Contents\n\n")
            f.write("File listing goes here\n")
        print(f"   ✅ Created {subdir.name}_contents.md", file=sys.stderr)
    except Exception as e:
        print(f"   ❌ Failed: {e}", file=sys.stderr)

print("\n" + "=" * 60, file=sys.stderr)
print("✅ SRC-DATA PROCESSOR COMPLETE", file=sys.stderr)
print("=" * 60, file=sys.stderr)
